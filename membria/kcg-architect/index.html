<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.11.0.813064204897">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.11.0">

    <!-- Primary Meta Tags -->
    <title>Membria: A Decentralized Knowledge Architecture</title>
    <meta name="title" content="Membria: A Decentralized Knowledge Architecture">
    <meta name="description" content="This document provides a detailed architectural specification for the integration of the Arweave network within the Membria Knowledge Cache Graph...">

    <!-- Canonical -->
    <link rel="canonical" href="https://docs.actiq.xyz/membria/kcg-architect/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://docs.actiq.xyz/membria/kcg-architect/">
    <meta property="og:title" content="Membria: A Decentralized Knowledge Architecture">
    <meta property="og:description" content="This document provides a detailed architectural specification for the integration of the Arweave network within the Membria Knowledge Cache Graph...">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://docs.actiq.xyz/membria/kcg-architect/">
    <meta property="twitter:title" content="Membria: A Decentralized Knowledge Architecture">
    <meta property="twitter:description" content="This document provides a detailed architectural specification for the integration of the Arweave network within the Membria Knowledge Cache Graph...">

    <script data-cfasync="false">(function(){var cl=document.documentElement.classList,ls=localStorage.getItem("retype_scheme"),hd=cl.contains("dark"),hl=cl.contains("light"),wm=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(ls==="dark"||(!ls&&wm&&!hd&&!hl)){cl.remove("light");cl.add("dark")}else if(ls==="light"||(!ls&&!wm&&!hd&&!hl)){cl.remove("dark");cl.add("light")}})();</script>

    <link href="../../static/favicon.png" rel="icon">
    <link href="../../resources/css/retype.css?v=3.11.0.813064204897" rel="stylesheet">

    <script data-cfasync="false" src="../../resources/js/config.js?v=3.11.0.813064204897" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../resources/js/retype.js?v=3.11.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../resources/js/lunr.js?v=3.11.0.813064204897" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../resources/js/prism.js?v=3.11.0.813064204897" defer></script>
    <script id="mermaid-js" data-cfasync="false" src="../../resources/js/mermaid.js?v=3.11.0" defer></script>
</head>
<body>
    <div id="retype-app" class="relative text-base antialiased text-base-text bg-base-bg font-body">
        <div class="absolute bottom-0 left-0" style="top: 5rem; right: 50%"></div>
    
        <header id="retype-header" class="sticky top-0 z-30 flex w-full h-16 bg-header-bg border-b border-header-border md:h-20">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton retype-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="retype-sidebar-left-toggle-button"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="retype-branding-logo" href="../../" class="flex items-center leading-snug text-2xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../static/light-logo.svg">
                                <img class="max-h-10 hidden dark:inline-block" src="../../static/dark-logo.svg">
                            </span>
                            <span class="dark:text-white font-bold line-clamp-1 md:line-clamp-2">Actiq</span>
                        </a><span id="retype-branding-label" class="inline-flex mt-1 px-2 py-1 ml-4 text-xs font-medium leading-none items-center rounded-md bg-branding-label-bg text-branding-label-text ring-1 ring-branding-label-border ring-inset md:inline-block">Litepaper</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block border-base-border"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav id="retype-header-nav" class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../../">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                        </g>
                                    </svg>
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://discord.gg/TQDtydDPgH" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/>
                                        </g>
                                    </svg>
                                    <span>Discord</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/actiquest-dev/">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"/>
                                        </g>
                                    </svg>
                                    <span>Github</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-search-placeholder transition-colors duration-200 ease-in bg-search-bg border border-transparent rounded md:text-sm hover:border-search-border-hover focus:outline-none focus:border-search-border-focus" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="retype-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
    
        <div id="retype-container" class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-sidebar-left-bg border-sidebar-left-border sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton">
            
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-filter-bg border border-filter-border rounded shadow-none text-sm focus:outline-none focus:border-filter-border-focus" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-base-border">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-base-border">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-base-border">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../../">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"/>
                                                </g>
                                            </svg>
                                            <span>Home</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://discord.gg/TQDtydDPgH" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 14.25 14H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 15.543V14H1.75A1.75 1.75 0 0 1 0 12.25v-9.5C0 1.784.784 1 1.75 1ZM1.5 2.75v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25Z"/><path d="M22.5 8.75a.25.25 0 0 0-.25-.25h-3.5a.75.75 0 0 1 0-1.5h3.5c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0 1 22.25 20H21v1.543a1.457 1.457 0 0 1-2.487 1.03L15.939 20H10.75A1.75 1.75 0 0 1 9 18.25v-1.465a.75.75 0 0 1 1.5 0v1.465c0 .138.112.25.25.25h5.5a.75.75 0 0 1 .53.22l2.72 2.72v-2.19a.75.75 0 0 1 .75-.75h2a.25.25 0 0 0 .25-.25v-9.5Z"/>
                                                </g>
                                            </svg>
                                            <span>Discord</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/actiquest-dev/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"/>
                                                </g>
                                            </svg>
                                            <span>Github</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 bg-body-bg">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div id="retype-main" class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="retype-markdown" id="retype-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="retype-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="membria-a-decentralized-knowledge-architecture" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#membria-a-decentralized-knowledge-architecture">#</doc-anchor-trigger>
        <span>Membria: A Decentralized Knowledge Architecture</span>
    </h1>
</doc-anchor-target>
<hr>
<doc-anchor-target id="abstract">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#abstract">#</doc-anchor-trigger>
        <span>Abstract</span>
    </h2>
</doc-anchor-target>
<p>This document provides a detailed architectural specification for the integration of the Arweave network within the Membria Knowledge Cache Graph (KCG). Membria employs a <strong>hybrid blockchain architecture</strong>, separating the logical, transactional operations of the graph from the permanent storage of its data payloads. This brief clarifies the specific role of Arweave as the immutable data archive, details the structure and format of the data stored, and provides an in-depth, step-by-step protocol for both writing data to and reading data from the Arweave permaweb. It&#x27;s intended for architects, developers, and stakeholders seeking to understand the foundational layer of trust and permanence within the Membria ecosystem.</p>
<p>We introduce the <strong>Decentralized Knowledge Graph (DKG)</strong>—a verifiable and efficient system for the continuous learning and reasoning enhancement of on-device, lightweight large language models (Tiny LLMs). Instead of costly retraining, Membria utilizes <strong>Distillation on Demand (DoD)</strong>, a process where knowledge from large &quot;teacher&quot; LLMs is re-checked, validated, and recorded as immutable events in a public graph. This approach allows Tiny LLMs to dynamically retrieve and leverage high-quality, verified knowledge through fast <strong>Cache-Augmented Generation (CAG)</strong> pipelines, drastically reducing latency, cost, and dependence on centralized APIs.</p>
<hr>
<doc-anchor-target id="1-core-architecture-a-symbiotic-hybrid-model">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1-core-architecture-a-symbiotic-hybrid-model">#</doc-anchor-trigger>
        <span>1: Core Architecture: A Symbiotic Hybrid Model</span>
    </h2>
</doc-anchor-target>
<p>Membria&#x27;s architecture is not a single blockchain but a symbiotic system that leverages the distinct strengths of two specialized networks: the Peaq Protocol for high-speed logic and Arweave for permanent data storage.</p>
<doc-anchor-target id="the-peaq-protocol-the-logicgraph-layer">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-peaq-protocol-the-logicgraph-layer">#</doc-anchor-trigger>
        <span><strong>The Peaq Protocol: The Logic/Graph Layer</strong></span>
    </h3>
</doc-anchor-target>
<p>The <strong>Peaq Protocol</strong> serves as the brain of the system. It manages the graph&#x27;s structure, rules, and transactional state. All logical operations—such as proposing knowledge, casting consensus votes, and defining data models—occur as lightweight transactions on the Peaq chain. Its core is a <strong>Temporal Semantic Graph</strong>, implemented as a Directed Acyclic Graph (DAG) where every node is an <strong>event</strong>. An event is an atomic, immutable, and cryptographically signed record of a specific fact or action. Each event contains standardized fields, including <code v-pre>actor</code> (who created it), <code v-pre>timestamp</code> (when), and <code v-pre>cause</code> (linking it to preceding events), providing a complete and auditable history.</p>
<doc-anchor-target id="the-arweave-permaweb-the-memory-layer">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-arweave-permaweb-the-memory-layer">#</doc-anchor-trigger>
        <span><strong>The Arweave Permaweb: The Memory Layer</strong></span>
    </h3>
</doc-anchor-target>
<p><strong>Arweave</strong> serves as the permanent, immutable memory for the DKG. While Peaq manages the &quot;who, what, when, and why&quot; of a knowledge event, Arweave stores the &quot;heavy&quot; data payload itself—the full text of a validated answer, for example. By offloading storage to Arweave, the Peaq chain remains fast and cost-effective, focusing solely on validating and ordering the logical event graph.</p>
<doc-anchor-target id="general-scheme">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#general-scheme">#</doc-anchor-trigger>
        <span><strong>General Scheme</strong></span>
    </h3>
</doc-anchor-target>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">graph TB
    %% Client Layer
    subgraph Client[&quot;🔵 CLIENT LAYER&quot;]
        direction LR
        SLM[&quot;👤 User/SLM&quot;]
        DoDAgent[&quot;📱 DoD Agent&lt;br/&gt;Lightweight Client&quot;]
        SLM &lt;--&gt; DoDAgent
    end

    %% Processing Layer - Main Gateway Logic
    subgraph Gateway[&quot;🟢 GATEWAY LAYER - Knowledge Lifecycle Engine&quot;]
        direction LR
        
        subgraph Input[&quot;INPUT&quot;]
            Router[&quot;🚪 API Router&quot;]
        end
        
        subgraph FastPath[&quot;⚡ FAST PATH&quot;]
            Cache[&quot;💾 State Graph Cache&quot;]
            SemanticSearch[&quot;🧠 Semantic Search&lt;br/&gt;Graph Transformer + cuGraph&quot;]
        end
        
        subgraph SlowPath[&quot;🔄 SLOW PATH&quot;]
            LLMEscalator[&quot;🚀 LLM Escalator&quot;]
            KnowledgeCreator[&quot;✨ Knowledge Creator&lt;br/&gt;Payload + Arweave + Consensus&quot;]
        end
        
        subgraph Background[&quot;📦 BACKGROUND&quot;]
            EventProcessor[&quot;🔄 Event Processor&quot;]
            ArchiveEngine[&quot;📚 Archive Engine&lt;br/&gt;Batching + DuckDB + Parquet&quot;]
        end
    end

    %% Teacher Services Layer
    subgraph Teacher[&quot;🤖 TEACHER SERVICES&quot;]
        LLMX[&quot;🧠 LLM-X&lt;br/&gt;OpenRouter&quot;]
    end

    %% Blockchain Layer
    subgraph Blockchain[&quot;⛓️ PEAQ BLOCKCHAIN&quot;]
        direction LR
        PeaqSubgraph[&quot;📊 Peaq Subgraph&lt;br/&gt;pallet-kcg&quot;]
        PeaqConsensus[&quot;🔐 Consensus Engine&lt;br/&gt;Verification Logic&quot;]
    end

    %% Storage Layer
    subgraph Storage[&quot;🟣 PERMANENT STORAGE - Arweave Permaweb&quot;]
        direction LR
        JSONFiles[&quot;📄 JSON Answers&lt;br/&gt;answers/{id}.json&quot;]
        ParquetArchives[&quot;📊 Parquet Archives&lt;br/&gt;batches/{ts}.parquet&quot;]
        ManifestIndex[&quot;📋 Manifest Index&lt;br/&gt;archive metadata&quot;]
    end

    %% Main Flow - Client Request
    DoDAgent --&gt;|&quot;API Request&quot;| Router
    
    %% Fast Path Flow
    Router --&gt; Cache
    Router --&gt; SemanticSearch
    Cache --&gt; SemanticSearch
    SemanticSearch --&gt;|&quot;Cache Hit&quot;| Router
    Router --&gt;|&quot;Fast Response&quot;| DoDAgent
    
    %% Slow Path Flow  
    Router --&gt;|&quot;Cache Miss&quot;| LLMEscalator
    LLMEscalator &lt;--&gt; LLMX
    LLMEscalator --&gt; KnowledgeCreator
    KnowledgeCreator &lt;--&gt; JSONFiles
    KnowledgeCreator &lt;--&gt; PeaqSubgraph
    PeaqSubgraph --&gt; PeaqConsensus
    KnowledgeCreator --&gt;|&quot;New Answer&quot;| Router
    
    %% Background Processing
    PeaqSubgraph --&gt; EventProcessor
    EventProcessor --&gt; Cache
    EventProcessor --&gt; ArchiveEngine
    ArchiveEngine &lt;--&gt; ParquetArchives
    ArchiveEngine --&gt; ManifestIndex
    
    %% State Sync
    PeaqSubgraph -.-&gt;|&quot;State Sync&quot;| Cache

    %% Styling by Layer
    classDef clientStyle fill:#3498db,stroke:#2980b9,color:#fff,stroke-width:2px
    classDef gatewayStyle fill:#2ecc71,stroke:#27ae60,color:#fff,stroke-width:2px
    classDef teacherStyle fill:#e67e22,stroke:#d35400,color:#fff,stroke-width:2px
    classDef blockchainStyle fill:#e74c3c,stroke:#c0392b,color:#fff,stroke-width:2px
    classDef storageStyle fill:#9b59b6,stroke:#8e44ad,color:#fff,stroke-width:2px
    classDef fastStyle fill:#27ae60,stroke:#2ecc71,color:#fff
    classDef slowStyle fill:#e67e22,stroke:#d35400,color:#fff
    classDef backgroundStyle fill:#16a085,stroke:#1abc9c,color:#fff
    
    class SLM,DoDAgent clientStyle
    class Router gatewayStyle
    class Cache,SemanticSearch fastStyle
    class LLMEscalator,KnowledgeCreator slowStyle
    class EventProcessor,ArchiveEngine backgroundStyle
    class LLMX teacherStyle
    class PeaqSubgraph,PeaqConsensus blockchainStyle
    class JSONFiles,ParquetArchives,ManifestIndex storageStyle</pre></div>
<hr>
<doc-anchor-target id="2-the-decentralized-knowledge-graph-dkg-layers--components">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2-the-decentralized-knowledge-graph-dkg-layers--components">#</doc-anchor-trigger>
        <span>2: The Decentralized Knowledge Graph (DKG): Layers &amp; Components</span>
    </h2>
</doc-anchor-target>
<p>The DKG is a living, self-organizing system composed of two primary layers: a flexible ontological foundation and a dynamic knowledge layer.</p>
<doc-anchor-target id="the-ontology-layer-a-flexible-system-of-dictionaries">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-ontology-layer-a-flexible-system-of-dictionaries">#</doc-anchor-trigger>
        <span><strong>The Ontology Layer: A Flexible System of Dictionaries</strong></span>
    </h3>
</doc-anchor-target>
<p>Membria rejects a rigid, universal ontology in favor of a flexible and modular approach. This allows for the creation of custom ontologies tailored to specific users or domains—a concept referred to as <em>&quot;сustom ontology for the client&quot;</em>.</p>
<ul>
<li><strong>Dictionaries as Building Blocks</strong>: The foundation of the ontology is <strong>&quot;dictionaries&quot;</strong>—reusable, named collections of concepts and relationships for a specific domain. Users can leverage public, standardized dictionaries (e.g., based on <strong>Schema.org</strong>) for broad interoperability or create their own private, specialized dictionaries for unique business needs.</li>
<li><strong>Marketplace of Dictionaries</strong>: The Membria ecosystem will feature a catalog or marketplace for dictionaries and semantic models. This encourages the reuse of high-quality ontologies and enhances interoperability across the network.</li>
<li><strong>On-Chain Definition on Peaq</strong>: The ontology and its dictionaries exist as <strong>genesis events</strong> on the Peaq blockchain, making them a fundamental and verifiable part of the graph&#x27;s structure.</li>
</ul>
<doc-anchor-target id="the-knowledge-layer-validated-answers-as-event-chains">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-knowledge-layer-validated-answers-as-event-chains">#</doc-anchor-trigger>
        <span><strong>The Knowledge Layer: Validated Answers as Event Chains</strong></span>
    </h3>
</doc-anchor-target>
<p>This is the dynamic layer where verified facts from teacher LLMs are recorded and interlinked.</p>
<ul>
<li><strong>Executable Semantic Models</strong>: Every type of knowledge (e.g., a &quot;Verified Answer&quot;) is governed by an <strong>Executable Semantic Model</strong> recorded on Peaq. Written in a declarative language like BSL, these models act as verifiable &quot;knowledge contracts.&quot; They define the data structure and the validation rules (<code v-pre>Restrictions</code>) that all new knowledge events must adhere to, ensuring deterministic and transparent logic execution.</li>
<li><strong>Reasoning Chains as Events</strong>: A verified answer from a teacher LLM is stored in the graph as a chain of events, cryptographically linked by the <code v-pre>cause</code> field. This provides a complete, auditable history for any fact, from the initial query to the final validation status.</li>
</ul>
<hr>
<doc-anchor-target id="3-the-lifecycle-of-knowledge-a-step-by-step-protocol">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#3-the-lifecycle-of-knowledge-a-step-by-step-protocol">#</doc-anchor-trigger>
        <span>3: The Lifecycle of Knowledge: A Step-by-Step Protocol</span>
    </h2>
</doc-anchor-target>
<p>The process of transforming a raw answer from a teacher LLM into a trusted DKG entry follows a precise, four-step lifecycle across both the Peaq and Arweave blockchains. The entire process, from a query to the retrieval of verified knowledge, is treated within the Membria architecture as the fulfillment of a primary system <strong>Intent</strong>: the <strong>&quot;Knowledge Distillation Request.&quot;</strong> This is a formalized goal, initiated by a user or a Tiny LLM, that triggers a well-defined sequence of events to achieve its objective. Each step of the protocol is a phase in this Intent&#x27;s lifecycle.</p>
<doc-anchor-target id="step-1-define-the-knowledge-contract-on-peaq">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-1-define-the-knowledge-contract-on-peaq">#</doc-anchor-trigger>
        <span><strong>Step 1: Define the &quot;Knowledge Contract&quot; on Peaq</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Action</strong>: Community experts define and deploy an Executable Semantic Model on the Peaq network. This model acts as a verifiable template for a &quot;validated knowledge entry.&quot;</li>
<li><strong>Protocol</strong>: An expert sends a transaction to Peaq containing a <strong>genesis event</strong> with the BSL code of the model as its payload. Once finalized, the model becomes an immutable part of the on-chain ontology. Arweave is not used in this step.</li>
<li><strong>Role in the Intent: Definition.</strong> This phase establishes the rules and the &quot;schema&quot; for the successful fulfillment of all future Intents of this type.</li>
</ul>
<doc-anchor-target id="step-2-propose-new-knowledge-via-arweave-and-peaq-see-4--5-for-details">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-2-propose-new-knowledge-via-arweave-and-peaq-see-4--5-for-details">#</doc-anchor-trigger>
        <span><strong>Step 2: Propose New Knowledge via Arweave and Peaq. (See ##4: &amp; ##5: for details).</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Role in the Intent: Execution.</strong> A DoD agent, acting to fulfill the Intent, obtains data from a &quot;teacher&quot; LLM, stores it on Arweave, and creates a proposal event on Peaq.</li>
</ul>
<doc-anchor-target id="step-3-gateway-consensus">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-3-gateway-consensus">#</doc-anchor-trigger>
        <span><strong>Step 3: Gateway Consensus</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Role in the Intent: Verification.</strong> A quorum of independent gateway agents verifies that the Intent was executed correctly and that the results comply with the predefined rules (the contract).</li>
</ul>
<doc-anchor-target id="step-4-finalizing-the-result">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-4-finalizing-the-result">#</doc-anchor-trigger>
        <span><strong>Step 4: Finalizing the Result</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Role in the Intent: Completion.</strong> A final <code v-pre>validation_event</code> is created, which officially closes the Intent by recording its outcome (success or failure) in the graph.</li>
</ul>
<hr>
<doc-anchor-target id="4-the-arweave-write-protocol">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#4-the-arweave-write-protocol">#</doc-anchor-trigger>
        <span>4: The Arweave Write Protocol</span>
    </h2>
</doc-anchor-target>
<p>This is the protocol for how a DoD Agent securely writes a knowledge payload to Arweave.</p>
<ol>
<li><strong>Trigger</strong>: Initiated by a DoD Agent after a teacher LLM generates a response, but <strong>before</strong> a proposal event is created on Peaq.</li>
<li><strong>Data Preparation</strong>: The agent assembles the knowledge payload into a <strong>JSON-LD (JSON for Linked Data)</strong> object. This ensures the data is machine-readable and semantically interoperable.</li>
<li><strong>Transaction Formation &amp; Tagging</strong>: The agent prepares an Arweave transaction. The JSON-LD object is the transaction&#x27;s data. A set of descriptive <strong>Tags</strong> is added, which are critical for efficient querying without needing to download the data itself.</li>
</ol>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th style="text-align: left;">Tag Name</th>
<th style="text-align: left;">Example Value</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code v-pre>Content-Type</code></td>
<td style="text-align: left;"><code v-pre>application/ld+json</code></td>
<td style="text-align: left;">Informs clients how to interpret the data.</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>App-Name</code></td>
<td style="text-align: left;"><code v-pre>Membria-DKG</code></td>
<td style="text-align: left;">Identifies the transaction as part of the Membria ecosystem.</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>App-Version</code></td>
<td style="text-align: left;"><code v-pre>3.0</code></td>
<td style="text-align: left;">Versions the protocol for future upgrades.</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>Event-Type</code></td>
<td style="text-align: left;"><code v-pre>ProposedAnswer</code></td>
<td style="text-align: left;">Specifies the type of knowledge event.</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>Query-ID</code></td>
<td style="text-align: left;"><code v-pre>{query_hash_on_peaq}</code></td>
<td style="text-align: left;">Links this data back to the originating query on Peaq.</td>
</tr>
</tbody>
</table>
</div>
<ol start="4">
<li><strong>Signing and Broadcasting</strong>: The agent signs the transaction and broadcasts it to the Arweave network. For efficiency, multiple small entries can be packaged into a single base transaction via a <strong>bundling service</strong>, significantly reducing cost and time.</li>
<li><strong>Confirmation and ID Retrieval</strong>: The Arweave network returns a permanent, unique <strong>Arweave Transaction ID (ArTxID)</strong>. This 43-character string is the immutable address of the knowledge payload.</li>
</ol>
<doc-anchor-target id="payload-example-arweave-json-ld-object">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#payload-example-arweave-json-ld-object">#</doc-anchor-trigger>
        <span><strong>Payload Example: Arweave JSON-LD Object</strong></span>
    </h3>
</doc-anchor-target>
<p>The following is a detailed example of the JSON-LD object stored on Arweave, representing a proposed answer.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-json"><code v-pre class="language-json">{
  &quot;@context&quot;: &quot;https://schema.org&quot;,
  &quot;@type&quot;: &quot;Answer&quot;,
  &quot;identifier&quot;: &quot;proposed_answer_uuid_xyz123&quot;,
  &quot;encodingFormat&quot;: &quot;application/ld+json&quot;,
  &quot;inResponseTo&quot;: {
    &quot;@type&quot;: &quot;Question&quot;,
    &quot;identifier&quot;: &quot;{query_event_hash_on_peaq}&quot;
  },
  &quot;author&quot;: {
    &quot;@type&quot;: &quot;AIApplication&quot;,
    &quot;name&quot;: &quot;GPT-4-Turbo&quot;,
    &quot;version&quot;: &quot;2024-04-09&quot;
  },
  &quot;dateCreated&quot;: &quot;2025-08-12T12:50:20Z&quot;,
  &quot;text&quot;: &quot;The Membria architecture separates logic and data. The Peaq Protocol manages the graph's transactional logic and structure as a Temporal Semantic Graph of events, while Arweave provides permanent, immutable storage for the actual data payloads.&quot;,
  &quot;keywords&quot;: [&quot;Membria&quot;, &quot;Architecture&quot;, &quot;Peaq&quot;, &quot;Arweave&quot;, &quot;Hybrid Blockchain&quot;]
}</code></pre>
</doc-codeblock></div>
<hr>
<doc-anchor-target id="advantages-of-this-approach">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#advantages-of-this-approach">#</doc-anchor-trigger>
        <span><strong>Advantages of This Approach</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Precision</strong>: This uses &quot;Intent&quot; approach but applies it specifically to the core process of Knowledge Distillation that Membria implements.</li>
<li><strong>Coherence</strong>: It creates a stronger, more unified narrative. The entire complex protocol now has a clear purpose: to fulfill one specific &quot;Intent.&quot;</li>
<li><strong>Scalability</strong>: This approach allows for the future addition of other &quot;Intent&quot; types (e.g., &quot;Request to generate a report&quot; or &quot;Initiate a voting process&quot;), which would logically fit into the same architecture.</li>
</ul>
<hr>
<doc-anchor-target id="5-the-peaq-proposal-protocol">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#5-the-peaq-proposal-protocol">#</doc-anchor-trigger>
        <span>5: The Peaq Proposal Protocol</span>
    </h2>
</doc-anchor-target>
<p><strong>Trigger:</strong> This protocol is initiated immediately after a DoD Agent successfully writes a data payload to the Arweave network and retrieves the unique Arweave Transaction ID (ArTxID).</p>
<p><strong>Protocol:</strong> The DoD Agent creates and broadcasts a lightweight transaction to the Peaq network. [cite_start]This transaction creates a <strong>domain event</strong> (<code v-pre>предметное событие</code>) that formally logs the new knowledge proposal on the logic layer[cite: 242].</p>
<p>The payload of this domain event is minimal but crucial, containing two key elements:</p>
<ul>
<li><strong>Data Pointer</strong>: A direct reference to the full data payload stored on Arweave, in the format of <code v-pre>data_pointer: &quot;{ArTxID}&quot;</code>. This creates the essential link between the logic layer (Peaq) and the permanent storage layer (Arweave).</li>
<li><strong>A graph edge</strong> is created in the event&#x27;s <code v-pre>cause</code> field, which contains the identifier of the original query event[cite: 72, 227]. [cite_start]This cryptographically links the new proposal to the action that prompted it, maintaining the auditable history of the Temporal Semantic Graph</li>
</ul>
<p><strong>Purpose:</strong> The successful execution of this protocol places the proposed knowledge into the DKG&#x27;s logical graph. It makes the proposal discoverable by the network&#x27;s Gateways and formally enters it into the next phase of the lifecycle: Gateway Consensus.</p>
<ul>
<li><strong>Action</strong>: The DoD Agent creates a lightweight transaction on the Peaq network to officially log the proposal.</li>
<li><strong>Protocol</strong>: The transaction contains a <strong>domain event</strong> (<code v-pre>proposed_answer_event</code>). Its payload includes a pointer to the data (<code v-pre>data_pointer: &quot;{ArTxID}&quot;</code>) and a graph edge in the <code v-pre>cause</code> field linking it to the original query event.</li>
</ul>
<doc-anchor-target id="step-1-gateway-consensus-on-peaq">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-1-gateway-consensus-on-peaq">#</doc-anchor-trigger>
        <span><strong>Step 1: Gateway Consensus on Peaq</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Action</strong>: A quorum of Gateways reviews the proposal. They use the <code v-pre>ArTxID</code> pointer to fetch the full data from Arweave and perform a detailed validation against the rules in the Knowledge Contract.</li>
<li><strong>Protocol</strong>: Gateways cast their votes (<code v-pre>attestation_event</code>) as transactions on the Peaq network. To optimize costs, these individual vote transactions can be <strong>batched</strong> into a single transaction before being submitted.</li>
</ul>
<doc-anchor-target id="step-2-finalize-the-result-on-peaq">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-2-finalize-the-result-on-peaq">#</doc-anchor-trigger>
        <span><strong>Step 2: Finalize the Result on Peaq</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Action</strong>: The outcome of the consensus vote is recorded immutably on Peaq, completing the knowledge lifecycle.</li>
<li><strong>Protocol</strong>: A final <code v-pre>validation_event</code> is created on Peaq. Its payload contains the final status (e.g., <code v-pre>Status: Verified</code>, <code v-pre>ConfidenceScore: 0.98</code>). Its <code v-pre>cause</code> field points to the <code v-pre>proposed_answer_event</code>, creating the final, definitive edge in the knowledge subgraph.</li>
</ul>
<hr>
<doc-anchor-target id="6-cost-optimization-transaction-batching-on-peaq">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#6-cost-optimization-transaction-batching-on-peaq">#</doc-anchor-trigger>
        <span>6: Cost Optimization: Transaction Batching on Peaq</span>
    </h2>
</doc-anchor-target>
<p>The Membria architecture incorporates transaction batching as a core feature to optimize network traffic and reduce operational costs on the Peaq network.</p>
<doc-anchor-target id="how-it-works">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#how-it-works">#</doc-anchor-trigger>
        <span><strong>How It Works</strong></span>
    </h3>
</doc-anchor-target>
<p>Instead of each Gateway submitting its consensus vote (<code v-pre>attestation_event</code>) during Phase 3 of the Intent lifecycle as a separate transaction, a designated coordinator node can gather multiple votes into a single &quot;batch.&quot; This approach is particularly effective for high-frequency, repetitive operations that are part of a single logical process.</p>
<doc-anchor-target id="the-protocol">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-protocol">#</doc-anchor-trigger>
        <span><strong>The Protocol</strong></span>
    </h3>
</doc-anchor-target>
<p>The batching protocol is straightforward:</p>
<ol>
<li><strong>Vote Submission</strong>: Individual Gateways in the consensus quorum sign their votes and send them to a designated coordinator node.</li>
<li><strong>Aggregation</strong>: The coordinator waits to receive multiple votes and aggregates these signed events into a single array or list.</li>
<li><strong>Batch Transaction</strong>: This single array of events is then submitted as the payload of a single transaction to the Peaq network.</li>
</ol>
<doc-anchor-target id="the-advantage">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-advantage">#</doc-anchor-trigger>
        <span><strong>The Advantage</strong></span>
    </h3>
</doc-anchor-target>
<p>This method drastically reduces transaction costs. [cite_start]The base network fee is paid once for the entire batch rather than for each individual micro-transaction. For processes like consensus voting, where many small, similar events are generated in a short period, batching provides a significant efficiency gain and makes the system more economical to operate.</p>
<hr>
<doc-anchor-target id="7-gateway-functionality-reading-and-managing-knowledge">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#7-gateway-functionality-reading-and-managing-knowledge">#</doc-anchor-trigger>
        <span>7: Gateway Functionality: Reading and Managing Knowledge</span>
    </h2>
</doc-anchor-target>
<p>Gateways are intelligent nodes that serve as the primary interface to the DKG for on-device agents.</p>
<doc-anchor-target id="the-read-protocol-an-intelligent-query-processor">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#the-read-protocol-an-intelligent-query-processor">#</doc-anchor-trigger>
        <span><strong>The Read Protocol: An Intelligent Query Processor</strong></span>
    </h3>
</doc-anchor-target>
<p>Gateways use a multi-layered strategy to find information, prioritizing speed and cost-efficiency. They <strong>do not</strong> blindly search the entire Arweave network.</p>
<ol>
<li><strong>Check &quot;Hot&quot; Cache (50-200 ms)</strong>: The Gateway first searches its own high-speed, off-chain KV-cache for a direct hit.</li>
<li><strong>Search Off-Chain Indexes</strong>: If there&#x27;s no cache hit, the Gateway consults its local semantic and vector indexes. These indexes act as a &quot;map&quot; of the entire DKG, allowing it to quickly locate relevant event hashes on Peaq.</li>
<li><strong>Retrieve Data from Arweave (300-1000 ms)</strong>: Only after the indexes have identified a relevant event on Peaq does the Gateway read its <code v-pre>data_pointer</code>. It then makes a targeted HTTP GET request to an Arweave gateway using the specific <code v-pre>ArTxID</code> to retrieve the &quot;heavy&quot; data payload.</li>
<li><strong>Assemble Context (SCR)</strong>: The Gateway aggregates the retrieved data into an enriched prompt for the Tiny LLM using the <strong>Selective Contextual Reasoning (SCR)</strong> pipeline.</li>
<li><strong>Fallback to DoD</strong>: If a high-confidence answer cannot be constructed from the DKG, the request is escalated to external &quot;teacher&quot; LLMs, triggering a new knowledge lifecycle.</li>
</ol>
<doc-anchor-target id="versioning-and-updates">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#versioning-and-updates">#</doc-anchor-trigger>
        <span><strong>Versioning and Updates</strong></span>
    </h3>
</doc-anchor-target>
<p>Knowledge stored on Arweave is <strong>permanent and cannot be overwritten</strong>. To update an entry, a new version of the JSON-LD object is uploaded to Arweave, receiving a <strong>new ArTxID</strong>. The logical graph on Peaq is then updated with a new event that supersedes the old one, and the mutable Gateway indexes are updated to point to the new ArTxID as the canonical version. All previous versions remain accessible on Arweave, providing a complete and verifiable audit trail.</p>
<hr>
<doc-anchor-target id="8-trust-validation-and-privacy">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#8-trust-validation-and-privacy">#</doc-anchor-trigger>
        <span>8: Trust, Validation, and Privacy</span>
    </h2>
</doc-anchor-target>
<p>The integrity of the DKG is secured by a multi-faceted trust model executed on the Peaq Protocol.</p>
<ul>
<li><strong>Hybrid Consensus Mechanism</strong>: Consensus among Gateways occurs exclusively on the Peaq blockchain. The network combines <strong>Proof-of-Stake (PoS)</strong> for validator security with <strong>Byzantine Fault-Tolerant (BFT)</strong> algorithms for rapid transaction finality.</li>
<li><strong>Dispute Resolution Protocol</strong>: An economically-incentivized challenge system allows any stakeholder to challenge a verified fact. The outcome is determined by a stake-weighted re-vote among validators, with <strong>slashing</strong> penalties for those who approved incorrect information or made a frivolous challenge.</li>
<li><strong>Privacy with Zero-Knowledge Proofs</strong>: The system integrates <strong>Zero-Knowledge Proofs</strong> via the <strong>Peaq ZK Layer</strong>. This enables confidential operations, such as a Gateway proving it has checked a fact against a private database without revealing the database, or a user proving they have the right to access knowledge without revealing their identity.</li>
</ul>
<hr>
<doc-anchor-target id="9-advanced-on-device-agent-capabilities">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#9-advanced-on-device-agent-capabilities">#</doc-anchor-trigger>
        <span>9: Advanced On-Device Agent Capabilities</span>
    </h2>
</doc-anchor-target>
<p>Membria&#x27;s architecture is designed to directly enhance the performance of on-device Tiny LLMs.</p>
<ul>
<li><strong>Context and Memory Management</strong>: Membria uses a <strong>Segmented KV Buffer</strong> for context window optimization and a hybrid <strong>Persistent Memory</strong> system (Local RAG Store + Disk-Based KV Archive) to prevent model &quot;amnesia&quot; between sessions.</li>
<li><strong>Synergy with Periodic LoRA Adaptation</strong>: An automated offline pipeline uses knowledge accumulated in the DKG to periodically fine-tune the base Tiny LLM using <strong>QLoRA</strong>. This enhances the model&#x27;s foundational understanding and embeds frequently used knowledge patterns directly into the model, often with minimal or no increase in its final size on the device.</li>
</ul>
<hr>
<doc-anchor-target id="10-conclusion-the-symbiotic-relationship">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#10-conclusion-the-symbiotic-relationship">#</doc-anchor-trigger>
        <span>10: Conclusion: The Symbiotic Relationship</span>
    </h2>
</doc-anchor-target>
<p>Arweave provides the indispensable foundation of <strong>trust, permanence, and verifiability</strong> for the Membria DKG. By serving as the immutable archive for all knowledge payloads, it allows the Peaq Protocol to operate as a fast, flexible, and efficient logic layer. This symbiotic relationship enables Membria to create a knowledge graph that is both dynamic and eternally auditable, solving the core problem of creating a lasting, shared memory for decentralized AI.</p>
<hr>
<doc-anchor-target id="kcg-architectural-addendum-for-engineers-and-integrators">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#kcg-architectural-addendum-for-engineers-and-integrators">#</doc-anchor-trigger>
        <span>KCG Architectural Addendum (for engineers and integrators).</span>
    </h1>
</doc-anchor-target>
<doc-anchor-target id="purpose">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#purpose">#</doc-anchor-trigger>
        <span>Purpose</span>
    </h2>
</doc-anchor-target>
<p>This addendum outlines additional architectural considerations for the <strong>Knowledge Cache Graph (KCG)</strong> in the Membria ecosystem. It focuses exclusively on elements that were missing or not fully detailed in the base architecture specification, with an emphasis on operational robustness, data integrity, indexing efficiency, and DAG integration over Peaq Protocol.</p>
<hr>
<doc-anchor-target id="1-formal-data-model">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1-formal-data-model">#</doc-anchor-trigger>
        <span>1: Formal Data Model</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="11-canonical-event-structure">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#11-canonical-event-structure">#</doc-anchor-trigger>
        <span>1.1: Canonical Event Structure</span>
    </h3>
</doc-anchor-target>
<p>All events in the temporal semantic graph MUST conform to a canonical JSON representation and hashing scheme.</p>
<p>{
&quot;id&quot;: &quot;sha256(&lt;canonical_event_json&gt;)&quot;,
&quot;actor&quot;: &quot;did:example:123456789abcdefghi&quot;,
&quot;model&quot;: &quot;urn:model:approval_v1&quot;,
&quot;cause&quot;: [&quot;&lt;event_id_1&gt;&quot;, &quot;&lt;event_id_2&gt;&quot;],
&quot;base&quot;: &quot;&lt;parent_event_id_or_null&gt;&quot;,
&quot;type&quot;: &quot;Attribute | Relation | Role | Act | Concept | Individual&quot;,
&quot;value&quot;: &quot;&lt;string | number | object | array | null&gt;&quot;,
&quot;timestamp&quot;: &quot;2025-08-12T21:15:00Z&quot;,
&quot;meta&quot;: {
&quot;version&quot;: &quot;1.0.0&quot;,
&quot;tags&quot;: [&quot;...&quot;],
&quot;signature&quot;: &quot;&lt;base64_signature&gt;&quot;
}
}</p>
<hr>
<p>Every KCG event should adhere to a <strong>canonical structure</strong> to ensure interoperability between independent gateways and external agents.<br />
While the base document defined core fields (<code v-pre>actor</code>, <code v-pre>timestamp</code>, <code v-pre>cause</code>), the following are required for deterministic processing:</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code v-pre>event_id</code></td>
<td>Hash</td>
<td>Unique event hash derived from all fields except signatures.</td>
</tr>
<tr>
<td><code v-pre>version</code></td>
<td>Integer</td>
<td>Event schema version.</td>
</tr>
<tr>
<td><code v-pre>payload_hash</code></td>
<td>Hash</td>
<td>SHA-256 of the immutable payload stored on Arweave.</td>
</tr>
<tr>
<td><code v-pre>signatures[]</code></td>
<td>Array</td>
<td>Signatures from event originator and validators.</td>
</tr>
<tr>
<td><code v-pre>ontology_ref</code></td>
<td>String</td>
<td>Reference to the ontology dictionary version used for semantic alignment.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Canonicalization:</strong></p>
<ul>
<li>Use JSON-LD 1.1 framing and <a href="https://json-ld.github.io/rdf-dataset-canonicalization/spec/">URDNA2015</a>for deterministic serialization.</li>
<li>Hash algorithm: SHA-256 over canonical form.</li>
</ul>
<p><strong>Rationale:</strong><br />
Explicit schema versioning and ontology references ensure future compatibility when updating semantic models.</p>
<hr>
<doc-anchor-target id="12-edge-types">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#12-edge-types">#</doc-anchor-trigger>
        <span>1.2: Edge Types</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="edges-in-the-dag-must-be-typed-allowed-edge-types">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#edges-in-the-dag-must-be-typed-allowed-edge-types">#</doc-anchor-trigger>
        <span>Edges in the DAG MUST be typed. Allowed edge types:</span>
    </h3>
</doc-anchor-target>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th style="text-align: left;">Edge Type</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code v-pre>cause</code></td>
<td style="text-align: left;">Causal relationship, required for all events</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>supersedes</code></td>
<td style="text-align: left;">Marks newer version replacing an older event</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>disputes</code></td>
<td style="text-align: left;">Links an event to one it challenges/disputes</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>depends_on</code></td>
<td style="text-align: left;">Denotes a dependency without strict causality</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>references</code></td>
<td style="text-align: left;">Soft reference, e.g., citation or metadata</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Rules:</strong></p>
<ul>
<li>DAG MUST remain acyclic for cause and supersedes.</li>
<li>Cycles allowed only for references.</li>
</ul>
<hr>
<doc-anchor-target id="13-versioning-and-lineage">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#13-versioning-and-lineage">#</doc-anchor-trigger>
        <span>1.3: Versioning and Lineage</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Each event MAY have zero or one supersedes link.</li>
<li>Canonical version = last event in the supersedes chain with no successor.</li>
<li>Clients MUST support retrieval of full lineage for audit.</li>
</ul>
<hr>
<doc-anchor-target id="14-readwrite-api-specification">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#14-readwrite-api-specification">#</doc-anchor-trigger>
        <span>1.4: Read/Write API Specification</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="rest-api-endpoints">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#rest-api-endpoints">#</doc-anchor-trigger>
        <span>REST API Endpoints</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="create-event">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#create-event">#</doc-anchor-trigger>
        <span>Create Event</span>
    </h4>
</doc-anchor-target>
<p>POST /events</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">Content-Type: application/json
Body: Event JSON without id (computed by server).
Response: { &quot;id&quot;: &quot;&lt;event_id&gt;&quot;, &quot;status&quot;: &quot;accepted&quot; }</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="get-event">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#get-event">#</doc-anchor-trigger>
        <span>Get Event</span>
    </h4>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">GET /events/{id}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="response-full-event-json">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#response-full-event-json">#</doc-anchor-trigger>
        <span>Response: Full event JSON.</span>
    </h4>
</doc-anchor-target>
<doc-anchor-target id="query-events">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#query-events">#</doc-anchor-trigger>
        <span>Query Events</span>
    </h4>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">POST /events/query
Content-Type: application/json</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="example">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#example">#</doc-anchor-trigger>
        <span>Example:</span>
    </h4>
</doc-anchor-target>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">{
  &quot;filters&quot;: [
    { &quot;field&quot;: &quot;actor&quot;, &quot;op&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;did:example:123&quot; },
    { &quot;field&quot;: &quot;type&quot;, &quot;op&quot;: &quot;in&quot;, &quot;value&quot;: [&quot;Attribute&quot;, &quot;Relation&quot;] }
  ],
  &quot;limit&quot;: 50,
  &quot;offset&quot;: 0,
  &quot;order_by&quot;: &quot;timestamp&quot;
}</code></pre>
</doc-codeblock></div>
<hr>
<doc-anchor-target id="15-indexing-and-search">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#15-indexing-and-search">#</doc-anchor-trigger>
        <span>1.5: Indexing and Search</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="index-types">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#index-types">#</doc-anchor-trigger>
        <span>Index Types</span>
    </h4>
</doc-anchor-target>
<ul>
<li>Semantic Index: By concept, property, ontology term.</li>
<li>Full-text Index: On string values.</li>
<li>Vector Index: For embeddings (optional, LLM-assisted).</li>
</ul>
<doc-anchor-target id="index-consistency">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#index-consistency">#</doc-anchor-trigger>
        <span>Index Consistency</span>
    </h4>
</doc-anchor-target>
<ul>
<li>Each index MUST store last processed event ID.</li>
<li>Periodic Merkle proofs verify index matches canonical DAG.</li>
</ul>
<hr>
<doc-anchor-target id="16-scr-selective-context-retrieval-for-edge-clients">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#16-scr-selective-context-retrieval-for-edge-clients">#</doc-anchor-trigger>
        <span>1.6: SCR (Selective Context Retrieval) for Edge Clients</span>
    </h3>
</doc-anchor-target>
<ul>
<li>SCR pipeline MUST define:</li>
<li>Input constraints: max token count / payload size.</li>
<li>Context selection policy: recency, relevance score, ontology match.</li>
<li>Caching: TTL, eviction policy, encryption for private data.</li>
<li>Cache format:</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">{
  &quot;event_id&quot;: &quot;...&quot;,
  &quot;embedding&quot;: [ ... ],
  &quot;summary&quot;: &quot;...&quot;,
  &quot;expires_at&quot;: &quot;...&quot;
}</code></pre>
</doc-codeblock></div>
<hr>
<doc-anchor-target id="17-tags-and-metadata">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#17-tags-and-metadata">#</doc-anchor-trigger>
        <span>1.7: Tags and Metadata</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Required tags: model, actor, version, timestamp, content_hash.</li>
<li>Tags MUST be stable across replays; version changes must be explicit.</li>
</ul>
<hr>
<doc-anchor-target id="18-privacy-pattern">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#18-privacy-pattern">#</doc-anchor-trigger>
        <span>1.8: Privacy Pattern</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Encrypt-then-store: Payload encrypted with a content key (CEK).</li>
<li>CEK encrypted separately per authorized recipient using their public key.</li>
<li>Encrypted payload stored in DAG; key grants managed out-of-band or in a KeyGrant event.</li>
</ul>
<hr>
<doc-anchor-target id="19-observability">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#19-observability">#</doc-anchor-trigger>
        <span>1.9: Observability</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Minimum metrics every node MUST expose:</li>
</ul>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code v-pre>event_ingest_latency_ms</code></td>
<td style="text-align: left;"><code v-pre>histogram</code></td>
<td style="text-align: left;">Time from reception to commit</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>event_validation_failures_total</code></td>
<td style="text-align: left;"><code v-pre>counter</code></td>
<td style="text-align: left;">Failed validation attempts</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>scr_cache_hit_ratio</code></td>
<td style="text-align: left;"><code v-pre>gauge</code></td>
<td style="text-align: left;">Cache effectiveness for SCR</td>
</tr>
<tr>
<td style="text-align: left;"><code v-pre>graph_fork_count</code></td>
<td style="text-align: left;"><code v-pre>counter</code></td>
<td style="text-align: left;">Number of local fork resolutions</td>
</tr>
</tbody>
</table>
</div>
<hr>
<doc-anchor-target id="110-consistency-and-fork-resolution">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#110-consistency-and-fork-resolution">#</doc-anchor-trigger>
        <span>1.10: Consistency and Fork Resolution</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Nodes MUST detect divergent DAG branches.</li>
<li>Merge rule: Prefer branch with more total events; tie-break by earliest timestamp of last event.</li>
<li>Fork resolution MUST be signed and recorded as a MergeEvent.</li>
</ul>
<hr>
<doc-anchor-target id="111-protocol-versioning">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#111-protocol-versioning">#</doc-anchor-trigger>
        <span>1.11: Protocol Versioning</span>
    </h3>
</doc-anchor-target>
<ul>
<li>SemVer: MAJOR.MINOR.PATCH.</li>
<li>Breaking changes increment MAJOR.</li>
<li>Clients MUST refuse events with higher MAJOR version unless in compatibility mode.</li>
</ul>
<hr>
<doc-anchor-target id="112-sequence-diagrams">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#112-sequence-diagrams">#</doc-anchor-trigger>
        <span>1.12: Sequence Diagrams</span>
    </h3>
</doc-anchor-target>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    
    participant AC as Actor/Edge Client
    participant GW as Gateway API
    participant VE as Validator &amp; Engine
    participant CM as Consensus Module
    participant DS as DAG Store
    participant IX as Indexer

    AC-&gt;&gt;AC: Build Event JSON
    AC-&gt;&gt;AC: Canonicalize &amp; hash -&gt; id
    AC-&gt;&gt;AC: Sign canonical bytes -&gt; signature
    AC-&gt;&gt;GW: POST /events {event, signature, idempotency_key?}
    
    GW-&gt;&gt;VE: Schema validate, JSON-LD frame, basic checks
    note over VE: On failure, returns 400/422 Bad Request and stops.
    
    GW-&gt;&gt;VE: Verify signature, check for duplicates
    
    alt Duplicate Found
        VE--&gt;&gt;GW: 200 OK {id, status: 'already_accepted'}
        GW--&gt;&gt;AC: 200 OK {id, status: 'already_accepted'}
    else New Event
        VE-&gt;&gt;CM: Propose for consensus
        note over CM: Runs appropriate consensus round (e.g., BFT, quorum, ack-only) based on the event's model.
        CM--&gt;&gt;VE: Consensus Result
        
        alt Accepted by Consensus
            VE-&gt;&gt;DS: Commit event atomically
            DS--&gt;&gt;VE: Commit OK
            
            VE--&gt;&gt;GW: 201 Created {id, finality, consistency_token}
            GW--&gt;&gt;AC: 201 Created {id, finality, consistency_token}
            
            par Indexing (Asynchronous)
                VE-&gt;&gt;IX: Enqueue index job
                IX-&gt;&gt;DS: Read committed event from store
                IX-&gt;&gt;IX: Update search index
            end
            
        else Rejected by Consensus
            VE--&gt;&gt;GW: 409 Conflict {reason: 'rejected by policy'}
            GW--&gt;&gt;AC: 409 Conflict {reason: 'rejected by policy'}
        end
    end</pre></div>
<doc-anchor-target id="notes">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#notes">#</doc-anchor-trigger>
        <span><strong>Notes</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Idempotency:</strong>  Clients SHOULD send  Idempotency-Key; server MUST dedupe by  (hash || key).</li>
<li><strong>Finality field:</strong>  none | soft | confirmed; depends on consensus profile for the model.</li>
<li><strong>Consistency token:</strong>  opaque cursor for “read-your-writes” on the read path.</li>
</ul>
<hr>
<doc-anchor-target id="113-scr-selective-context-retrieval-pipeline">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#113-scr-selective-context-retrieval-pipeline">#</doc-anchor-trigger>
        <span>1.13: SCR (Selective Context Retrieval) Pipeline</span>
    </h3>
</doc-anchor-target>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    participant EC as Edge Client (Tiny LLM)
    participant GW as Gateway API
    participant QP as Query Planner
    participant IX as Indexer
    participant CC as Client Cache

    EC-&gt;&gt;CC: Check cache for query intent (embedding/rewrite)
    alt Cache hit and fresh
        CC--&gt;&gt;EC: Context bundle
        EC--&gt;&gt;EC: Compose prompt with bundle
    else Miss or stale
        EC-&gt;&gt;GW: /events/query {filters, embed=true, top_k}
        GW-&gt;&gt;QP: Build semantic+vector plan
        QP-&gt;&gt;IX: Retrieve top_k candidates (+ summaries)
        IX--&gt;&gt;QP: Candidates
        QP--&gt;&gt;GW: Context bundle + TTL
        GW--&gt;&gt;EC: Bundle
        EC-&gt;&gt;CC: Store bundle with TTL &amp; size limits
        EC--&gt;&gt;EC: Compose prompt
    end</pre></div>
<doc-anchor-target id="notes-1">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#notes-1">#</doc-anchor-trigger>
        <span><strong>Notes</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Bundle format:</strong>  event ids, summaries, citations, optional embeddings.</li>
<li><strong>Limits:</strong>  max bundle tokens, per‑device cache size, LRU eviction.</li>
<li><strong>Privacy:</strong>  bundle items may be encrypted; cache MUST respect TTL and key revocation.</li>
</ul>
<hr>
<doc-anchor-target id="2-gateway-index-architecture">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2-gateway-index-architecture">#</doc-anchor-trigger>
        <span>2: Gateway Index Architecture</span>
    </h2>
</doc-anchor-target>
<p>Gateways act as the primary query layer for the DKG. To optimize retrieval, each gateway should maintain:</p>
<ol>
<li><p><strong>Hot Cache (RAM)</strong></p>
<ul>
<li>KV store for the most frequently accessed <code v-pre>event_id</code> → payload mappings.</li>
<li>TTL-based eviction to keep memory footprint predictable.</li>
</ul>
</li>
<li><p><strong>Semantic Index</strong></p>
<ul>
<li>Stores mappings from ontology concepts to event IDs.</li>
<li>Enables concept-based search without scanning full graph.</li>
</ul>
</li>
<li><p><strong>Vector Index</strong></p>
<ul>
<li>Embedding-based similarity search for approximate reasoning queries.</li>
<li>Periodically rebuilt or incrementally updated after consensus events.</li>
</ul>
</li>
<li><p><strong>Arweave Pointer Map</strong></p>
<ul>
<li>Minimal persistent index of <code v-pre>event_id</code> → <code v-pre>ArTxID</code> for quick deep retrieval.</li>
</ul>
</li>
<li><p><strong>Dispute (challenge) Flow (condensed)</strong></p>
</li>
</ol>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    participant CL as Challenger
    participant GW as Gateway API
    participant VE as Validator &amp; Engine
    participant CM as Consensus Module
    participant DS as DAG Store

    CL-&gt;&gt;GW: POST /events {disputes: &lt;event_id&gt;, evidence...}
    GW-&gt;&gt;VE: Validate dispute event + evidence refs
    VE-&gt;&gt;CM: Open challenge window (model policy)
    CM-&gt;&gt;CM: Collect attestations/counter-evidence
    CM--&gt;&gt;VE: Decision {uphold | overturn}
    alt Overturn
        VE-&gt;&gt;DS: Commit Supersede/Invalidation events
    else Uphold
        VE-&gt;&gt;DS: Commit Resolution event
    end
    DS--&gt;&gt;VE: Commit OK
    VE--&gt;&gt;GW: 200 resolution {status}
    GW--&gt;&gt;CL: 200 resolution {status}</pre></div>
<ol start="6">
<li><strong>Read/Query Path (with “read-your-writes”)</strong></li>
</ol>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    participant AC as Actor/Client
    participant GW as Gateway API
    participant QP as Query Planner
    participant IX as Indexer
    participant DS as DAG Store

    AC-&gt;&gt;GW: POST /events/query {filters..., consistency_token?}
    GW-&gt;&gt;QP: Normalize filters, expand ontology terms
    alt Consistency token present
        QP-&gt;&gt;IX: Ensure IX.last_processed_id &gt;= token
        IX--&gt;&gt;QP: OK (or wait/retry until fresh)
    end
    QP-&gt;&gt;IX: Execute against indices (semantic/vector/full-text)
    alt Index hit incomplete (needs hydrate)
        IX-&gt;&gt;DS: Fetch missing events by id
        DS--&gt;&gt;IX: Events
        IX--&gt;&gt;QP: Materialized results
    else Index sufficient
        IX--&gt;&gt;QP: Results
    end
    QP--&gt;&gt;GW: Page of events + page_token + current_consistency_token
    GW--&gt;&gt;AC: 200 {items[], page_token, consistency_token}</pre></div>
<ol start="7">
<li><strong>Optional Batch Aggregation (when models use batching)</strong></li>
</ol>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    participant GW as Gateway API
    participant BA as Batch Aggregator
    participant CM as Consensus Module
    participant DS as DAG Store

    GW-&gt;&gt;BA: Append validated event to batch(model, window)
    BA-&gt;&gt;BA: Batch roll window / size threshold
    alt Threshold met or window elapsed
        BA-&gt;&gt;CM: Submit batch proposal (aggregate signature)
        CM-&gt;&gt;CM: Run consensus on batch
        CM--&gt;&gt;BA: Batch accepted
        BA-&gt;&gt;DS: Commit all events atomically (batch tx)
        DS--&gt;&gt;BA: OK (record batch_id)
        BA--&gt;&gt;GW: Notify per-event status {id, batch_id}
    else Keep buffering
        BA--&gt;&gt;GW: 202 accepted (pending)
    end</pre></div>
<doc-anchor-target id="notes-2">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#notes-2">#</doc-anchor-trigger>
        <span><strong>Notes</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Pagination:</strong>  limit, page_token.</li>
<li><strong>Ordering:</strong>  default  timestamp ASC, override via  order_by.</li>
<li><strong>Consistency:</strong>  Server MAY block until index catches up to  consistency_token.</li>
</ul>
<hr>
<doc-anchor-target id="3-fork-resolution-protocol">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#3-fork-resolution-protocol">#</doc-anchor-trigger>
        <span>3: Fork Resolution Protocol</span>
    </h2>
</doc-anchor-target>
<p>Even in a DAG-based architecture, transient forks or conflicting attestations can occur.<br />
We define a <strong>Fork Resolution Protocol</strong>:</p>
<ol>
<li><p><strong>Detection</strong></p>
<ul>
<li>Gateways detect multiple competing validation events for the same proposal.</li>
</ul>
</li>
<li><p><strong>Resolution Rules</strong></p>
<ul>
<li>Prefer the branch with the higher stake-weighted consensus.</li>
<li>If equal, prefer the branch with the earliest finalized timestamp.</li>
</ul>
</li>
<li><p><strong>Pruning</strong></p>
<ul>
<li>Once resolved, outdated branches are marked as <code v-pre>orphaned</code> in indexes but remain retrievable for audit.</li>
</ul>
</li>
<li><p><strong>Fork Detection &amp; Mesh</strong></p>
</li>
</ol>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">sequenceDiagram
    autonumber
    participant ND as Node
    participant DS as DAG Store
    participant CM as Consensus Module

    ND-&gt;&gt;DS: Append event e(n)
    DS--&gt;&gt;ND: OK
    ND-&gt;&gt;ND: Receive conflicting chain head e'(n)
    ND-&gt;&gt;CM: Verify consensus lineage for both heads
    CM--&gt;&gt;ND: Preferred branch = {more events | tie-break by earliest last-ts}
    alt Switch required
        ND-&gt;&gt;DS: Record MergeEvent {from: losing_head, to: winning_head}
        DS--&gt;&gt;ND: OK
        ND-&gt;&gt;ND: Rebuild indices incrementally
    else Keep current head
        ND--&gt;&gt;ND: No-op
    end</pre></div>
<hr>
<doc-anchor-target id="4-dag-implementation-on-peaq-protocol">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#4-dag-implementation-on-peaq-protocol">#</doc-anchor-trigger>
        <span>4. DAG Implementation on Peaq Protocol</span>
    </h2>
</doc-anchor-target>
<p>Use Peaq for ordering, attestation, and light headers, while keeping full payloads off‑chain (Arweave). We can also run a pure‑Peaq mode for small events. The Directed Acyclic Graph (DAG) structure is implemented at the <strong>event layer</strong> on Peaq:</p>
<ul>
<li><strong>Nodes:</strong> Represent immutable knowledge events.</li>
<li><strong>Edges:</strong> Defined via the <code v-pre>cause</code> field to ensure causal ordering.</li>
<li><strong>Topological Ordering:</strong> Enforced at insertion time to prevent cycles.</li>
<li><strong>Parallelism:</strong> Independent branches can be validated concurrently.</li>
</ul>
<p><strong>Mermaid Diagram:</strong></p>
<div class="overflow-hidden mb-6 py-4 dark:px-5 dark:bg-white rounded-md"><pre translate="no" class="mermaid w-full">graph TD
    Q1[Query Event] --&gt; P1[Proposed Answer]
    P1 --&gt; V1[Validation Event]
    P1 --&gt; A1[Attestation Event 1]
    P1 --&gt; A2[Attestation Event 2]</pre></div>
<doc-anchor-target id="custom-pallet-pallet-kcg">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#custom-pallet-pallet-kcg">#</doc-anchor-trigger>
        <span><strong>Custom pallet: pallet-kcg</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Define compact on‑chain headers and batch commitments.</li>
</ul>
<p><strong>Types</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">pub struct EventHeader {
  pub event_id: H256,          // sha256 of canonical payload
  pub model_urn: BoundedVec&lt;u8, _&gt;,
  pub actor: BoundedVec&lt;u8, _&gt;, // DID or account binding
  pub ts: u64,                 // unix ms
  pub ar_tx: Option&lt;BoundedVec&lt;u8, _&gt;&gt;, // Arweave tx id (if off-chain)
}

pub struct Adjacency {
  pub event_id: H256,
  pub cause: BoundedVec&lt;H256, _&gt;, // parent ids
}

pub struct BatchCommit {
  pub batch_id: H256,
  pub merkle_root: H256,       // over canonical event bytes
  pub count: u32,
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="extrinsics">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#extrinsics">#</doc-anchor-trigger>
        <span><strong>Extrinsics</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>propose_event(header: EventHeader, adj: Adjacency, sig: Signature)</li>
<li>finalize_event(event_id: H256) or finalize_batch(commit: BatchCommit)</li>
<li>dispute(event_id: H256, evidence_ref: Vec<u8>)</li>
<li>checkpoint(root: H256, height: u64) (optional, for fast trust)</li>
</ul>
<doc-anchor-target id="events-runtime">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#events-runtime">#</doc-anchor-trigger>
        <span><strong>Events (runtime)</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Proposed(event_id)</li>
<li>Finalized(event_id | batch_id)</li>
<li>Disputed(event_id)</li>
<li>Checkpoint(root)</li>
</ul>
<hr>
<doc-anchor-target id="5-write-path-two-practical-modes">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#5-write-path-two-practical-modes">#</doc-anchor-trigger>
        <span>5: Write path (two practical modes)</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="mode-a-headeronly-on-peaq-payload-on-arweave">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#mode-a-headeronly-on-peaq-payload-on-arweave">#</doc-anchor-trigger>
        <span>Mode A (Header‑only on Peaq, payload on Arweave)</span>
    </h3>
</doc-anchor-target>
<ol>
<li><strong>Client canonicalizes and signs payload.</strong></li>
<li><strong>Upload payload to Arweave; get  ar_tx.</strong></li>
<li cause=""><strong>Call propose_event</strong>{ header{event_id, model, actor, ts, ar_tx}, adj, sig }</li>
<li><strong>Gateways/validators check:</strong>
<ul>
<li>signature against DID/account</li>
<li>Arweave availability of ar_tx</li>
<li>parents exist (either on‑chain header present or in same batch)</li>
<li>no cycle (local index check)</li>
</ul>
</li>
<li>Runtime marks it  <strong>proposed</strong>; when policy met (e.g., quorum or authority), call  finalize_event  or include in a  finalize_batch.</li>
<li>Indexers watch Peaq events, fetch payloads by  ar_tx, and update local indices.</li>
</ol>
<doc-anchor-target id="mode-b--full-payload-on-peaq-for-tiny-events">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#mode-b--full-payload-on-peaq-for-tiny-events">#</doc-anchor-trigger>
        <span>Mode B — Full payload on Peaq for tiny events)</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Put canonical payload bytes as  Vec<u8>  in the extrinsic (or store in an on‑chain blob map).</li>
<li>Costs rise quickly; use sparingly or for “critical minimal facts.”</li>
</ul>
<doc-anchor-target id="batching-on-peaq">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#batching-on-peaq">#</doc-anchor-trigger>
        <span><strong>Batching on Peaq</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Aggregate many  event_ids off‑chain, compute Merkle root.</li>
<li>Submit finalize_batch{batch_id, merkle_root, count} to the pallet.</li>
<li>Emit Finalized(batch_id).</li>
<li>Each leaf (event) still has its header on‑chain (cheap); the batch just finalizes them in one shot.</li>
</ul>
<doc-anchor-target id="identity--signatures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#identity--signatures">#</doc-anchor-trigger>
        <span><strong>Identity &amp; signatures</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Bind DID ↔ Peaq account (one‑time link event) or use DID‑Key as the signing key if supported.</li>
<li>The pallet verifies signatures over the  <strong>same canonical bytes</strong>  used to derive  event_id.</li>
</ul>
<doc-anchor-target id="reading">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reading">#</doc-anchor-trigger>
        <span><strong>Reading</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Light clients:</p>
<ul>
<li>Query Peaq RPC for EventHeader/Adjacency by event_id.</li>
<li>If  ar_tx  present, fetch payload from Arweave and re‑verify  event_id  and signature.</li>
</ul>
</li>
<li><p>Heavy clients:</p>
<ul>
<li>Subscribe to runtime events, stream headers, hydrate payloads, maintain topo index.</li>
</ul>
</li>
</ul>
<doc-anchor-target id="consistency-finality-forks">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#consistency-finality-forks">#</doc-anchor-trigger>
        <span><strong>Consistency, finality, forks</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Rely on Peaq’s chain finality (GRANDPA‑style). Only treat events as  <strong>final</strong>  after finalized block.</li>
<li>If you ingest from mempool or non‑finalized blocks, tag results as  soft.</li>
<li>On reorgs: reprocess affected headers; your local index replaces losing heads. Record a signed  <strong>MergeEvent</strong>off‑chain (or an on‑chain note if you expose one).</li>
</ul>
<doc-anchor-target id="disputes">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#disputes">#</doc-anchor-trigger>
        <span><strong>Disputes</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>dispute(event_id, evidence_ref)  stores a lightweight on‑chain record and opens a  <strong>challenge window</strong>  (pallet policy).</p>
</li>
<li><p>Resolution emits either:</p>
<ul>
<li>Finalized(superseding_event_id) (if overturned)</li>
<li>or a Resolution(event_id, status=upheld) runtime event.</li>
</ul>
</li>
<li><p>Off‑chain indexers mirror the resolution by linking  supersedes.</p>
</li>
</ul>
<doc-anchor-target id="cost-control">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cost-control">#</doc-anchor-trigger>
        <span><strong>Cost control</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Keep headers compact; move bulk to Arweave.</li>
<li>Prefer <strong>batch finalization</strong>.</li>
<li>Compress adjacency: if there are many parents, store only first K on‑chain and put the full set in Arweave; include a  <strong>parent set hash</strong>  in the header to bind them.</li>
</ul>
<doc-anchor-target id="minimal-guarantees-both-stores">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#minimal-guarantees-both-stores">#</doc-anchor-trigger>
        <span><strong>Minimal guarantees (both stores)</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Integrity:</strong>  event_id = sha256(canonical(payload)); signatures over the same bytes.</li>
<li><strong>Acyclicity:</strong>  enforced by gateways/indexers before accept; rejected events never get posted.</li>
<li><strong>Replay safety:</strong>  duplicate  event_id  is idempotent; pallet returns “already proposed/finalized”.</li>
<li><strong>Discoverability:</strong>  stable tag schema (Arweave) and stable runtime storage keys (Peaq).</li>
</ul>
<doc-anchor-target id="4-dag-implementation-on-arweave-possible-alternative">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#4-dag-implementation-on-arweave-possible-alternative">#</doc-anchor-trigger>
        <span>4: DAG Implementation on Arweave (possible alternative)</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="what-lives-on-arweave">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#what-lives-on-arweave">#</doc-anchor-trigger>
        <span><strong>What lives on Arweave?</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Full event payloads (JSON‑LD, encrypted if needed)</li>
<li>Adjacency (list of cause event IDs)</li>
<li>Detached signatures (or included in payload)</li>
<li>Minimal headers duplicated in tags for fast search</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">{
  &quot;id&quot;: &quot;ev_&lt;sha256(canonical_bytes)&gt;&quot;,
  &quot;actor&quot;: &quot;did:example:abc&quot;,
  &quot;model&quot;: &quot;urn:model:approval_v1&quot;,
  &quot;type&quot;: &quot;Attribute|Relation|Act|Concept|Individual|Role&quot;,
  &quot;value&quot;: { &quot;...&quot;: &quot;...&quot; },
  &quot;cause&quot;: [&quot;ev_...&quot;,&quot;ev_...&quot;],
  &quot;timestamp&quot;: &quot;2025-08-12T21:15:00Z&quot;,
  &quot;signature&quot;: &quot;base64(ed25519(sig over canonical_bytes))&quot;,
  &quot;meta&quot;: { &quot;version&quot;: &quot;1.0.0&quot;, &quot;content_hash&quot;: &quot;sha256(...)&quot; }
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="arweave-transaction-layout">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#arweave-transaction-layout">#</doc-anchor-trigger>
        <span><strong>Arweave transaction layout</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>Data</strong>: the canonical event JSON (optionally encrypted: CEK → payload, CEK wrapped per recipient).</li>
<li><strong>Tags</strong>  (flat, stable keys; repeatable where needed):
<ul>
<li>App: KCG</li>
<li>App-Version: 1.0.0</li>
<li>Event-Id: ev_...</li>
<li>Event-Type: Attribute|Relation|...</li>
<li>Actor-DID: did:...</li>
<li>Model-URN: urn:model:...</li>
<li>Cause-Id: repeated tag for each parent (0..N)</li>
<li>Timestamp: ISO8601</li>
<li>Content-Hash: sha256(...)</li>
<li>Sig-Alg: ed25519</li>
<li>Sig-Base64: detached signature (if you don’t embed it)</li>
</ul>
</li>
</ul>
<p>This gives you direct GraphQL filtering by  Event-Id,  Actor-DID,  Model-URN, and by multiple  Cause-Id.</p>
<doc-anchor-target id="acyclicity-and-validation">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#acyclicity-and-validation">#</doc-anchor-trigger>
        <span><strong>Acyclicity and validation</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Gateways validate locally  <strong>before</strong>  upload:</p>
<ul>
<li>every  cause  exists (by  Event-Id)</li>
<li>id  matches canonical hash</li>
<li>signatures verify</li>
<li>no path back from any  cause  to this  id  (local index check)</li>
</ul>
</li>
<li><p>If any check fails, the event never gets uploaded.</p>
</li>
</ul>
<doc-anchor-target id="batching-optional-but-recommended">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#batching-optional-but-recommended">#</doc-anchor-trigger>
        <span><strong>Batching (optional but recommended)</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Use  <strong>Bundlr</strong>  (or arweave bundles) to batch many events.</li>
<li>Create a  <strong>batch manifest</strong>  object with:
<ul>
<li>batch_id</li>
<li>list of  Event-Id&#x27;s</li>
<li><strong>Merkle root</strong>  over the canonical bytes of all events</li>
</ul>
</li>
<li>Store the manifest as its own Arweave tx:
<ul>
<li>Tags: KCG-Batch-Id, KCG-Merkle-Root.</li>
</ul>
</li>
<li>Each event still has its own tx; the batch manifest just commits a root for quick integrity checks.</li>
</ul>
<doc-anchor-target id="read-path">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#read-path">#</doc-anchor-trigger>
        <span><strong>Read path</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Query Arweave GraphQL by tags; hydrate events.</li>
<li>Verify  id, signatures, and that all  cause  events are present.</li>
<li>Build/maintain a <strong>local adjacency index</strong>:
<ul>
<li>parents[id] = [...cause]</li>
<li>children[id] = [...] (derived)</li>
<li>Record  <strong>topo order</strong>  for fast cycle checks and lineage walks.</li>
</ul>
</li>
</ul>
<doc-anchor-target id="consistency-and-finality">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#consistency-and-finality">#</doc-anchor-trigger>
        <span><strong>Consistency and “finality”</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li>Arweave is append‑only, but you still want  <strong>gateway‑level finality</strong>:
<ul>
<li><p>Keep a signed  <strong>Checkpoint</strong>  (Arweave tx with tag  KCG-Checkpoint) that includes:</p>
<ul>
<li><p>high‑water mark (last known stable topo index)</p>
</li>
<li><p>Merkle root over the set of  Event-Ids ≤ checkpoint</p>
</li>
</ul>
</li>
<li><p>Clients can trust up to the last Checkpoint without replaying the world.</p>
</li>
</ul>
</li>
</ul>
<doc-anchor-target id="disputes-1">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#disputes-1">#</doc-anchor-trigger>
        <span><strong>Disputes</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>A  <strong>Dispute</strong>  is just another event:</p>
<ul>
<li><p>type: &quot;Act&quot;, disputes: &quot;<Event-Id>&quot;</p>
</li>
<li><p>Stored as a normal Arweave tx, linked via  Cause-Id  or a  Disputes  tag.</p>
</li>
</ul>
</li>
<li><p>Gateways follow your policy to “overturn” by emitting a  supersedes  event that points to a corrected event.</p>
</li>
</ul>
<hr>
<doc-anchor-target id="5-api-contracts">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#5-api-contracts">#</doc-anchor-trigger>
        <span>5: API Contracts</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="event-ingestion-api">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#event-ingestion-api">#</doc-anchor-trigger>
        <span><strong>Event Ingestion API</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li><strong>POST /events</strong></li>
<li>Payload:</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-json"><code v-pre class="language-json">{
  &quot;event_id&quot;: &quot;...&quot;,
  &quot;version&quot;: 1,
  &quot;payload_hash&quot;: &quot;...&quot;,
  &quot;ontology_ref&quot;: &quot;schema.org/v1&quot;,
  &quot;signatures&quot;: [&quot;sig1&quot;, &quot;sig2&quot;],
  &quot;cause&quot;: &quot;event_hash&quot;,
  &quot;data_pointer&quot;: &quot;ArTxID&quot;
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="event-query-api">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#event-query-api">#</doc-anchor-trigger>
        <span><strong>Event Query API</strong></span>
    </h3>
</doc-anchor-target>
<ul>
<li event_id=""><strong>GET /events/</strong></li>
<li>Supports query by:
<ul>
<li><code v-pre>event_id</code></li>
<li><code v-pre>ontology_concept</code></li>
<li><code v-pre>vector_embedding</code></li>
</ul>
</li>
</ul>
<hr>
<doc-anchor-target id="6-privacy-enhancements">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#6-privacy-enhancements">#</doc-anchor-trigger>
        <span>6: Privacy Enhancements</span>
    </h2>
</doc-anchor-target>
<p>To align with zero-knowledge patterns:</p>
<ul>
<li>Gateways can issue <strong>ZK proofs</strong> of validation without exposing raw data.</li>
<li>Example: Prove that a fact was checked against a private dataset without revealing dataset contents.</li>
</ul>
<hr>
<doc-anchor-target id="7-metrics-and-observability">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#7-metrics-and-observability">#</doc-anchor-trigger>
        <span>7: Metrics and Observability</span>
    </h2>
</doc-anchor-target>
<p>Operational metrics for gateways:</p>
<ul>
<li><code v-pre>avg_query_latency_ms</code></li>
<li><code v-pre>cache_hit_ratio</code></li>
<li><code v-pre>consensus_vote_time</code></li>
<li><code v-pre>fork_resolution_count</code></li>
<li><code v-pre>arweave_retrieval_time</code></li>
</ul>
<p>All metrics should be exposed via a <code v-pre>/metrics</code> endpoint in Prometheus format.</p>
<hr>
<doc-anchor-target id="8-security-considerations">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#8-security-considerations">#</doc-anchor-trigger>
        <span>8: Security Considerations</span>
    </h2>
</doc-anchor-target>
<ul>
<li><strong>Replay Protection:</strong> Every event includes a nonce and timestamp.</li>
<li><strong>Sybil Resistance:</strong> Gateway participation requires staking on Peaq.</li>
<li><strong>Data Immutability:</strong> Enforcement via Arweave transaction permanence.</li>
</ul>
<hr>
<doc-anchor-target id="9-conclusion">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#9-conclusion">#</doc-anchor-trigger>
        <span>9: Conclusion</span>
    </h2>
</doc-anchor-target>
<p>This addendum provides the missing operational, indexing, and integrity details for the KCG architecture.<br />
By integrating these enhancements, Membria gains stronger query performance, auditability, and fault tolerance, without deviating from the core hybrid model of Peaq (logic) + Arweave (storage).</p>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer id="retype-content-footer" class="clear-both">
                            
                                <nav id="retype-nextprev" class="print:hidden flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../membria/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-base-text-muted">Previous</span>
                                                <span class="block mt-1">Membria</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../membria/client/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-base-text-muted">Next</span>
                                                <span class="block mt-1">Membria Client</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div id="retype-page-footer" class="print:border-none border-t border-base-border pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between print:justify-center">
                                <div id="retype-footer-links" class="print:hidden">
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div id="retype-copyright" class="print:justify-center py-2 text-footer-text font-footer-link-weight text-sm leading-relaxed"><p>© Copyright 2025, <a href="https://actiq.xyz">Actiquest Inc.</a> All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-sidebar-right-bg border-sidebar-right-border lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="retype-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "KCG Architecture", level: 2, icon: "file", hasPrism: true, hasMermaid: true, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
